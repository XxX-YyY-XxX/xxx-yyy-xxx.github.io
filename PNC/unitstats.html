<!DOCTYPE html>
<html>
    <head>
        <script defer type="text/javascript" src="/univasset/scripts/include/includefile.js"></script>
        <script type="module">
            import { AsyncFunc, Compare, initializeHTML } from "/univasset/scripts/externaljavascript.js";
            const json = (await AsyncFunc.getJSON('./unitstats.json')).slice(0, -1);

            table(document.querySelector('#main_content div'), json, {sort: true})
            
            /** @param {HTMLElement} grouperElem
             * @param {Array[]} tablerows */
            function table(grouperElem, tablerows, {sort = false, filter = false} = {}) {
                const tableElem = document.createElement('table');
                const theadElem = document.createElement('thead');
                const tbodyElem = document.createElement('tbody');
                //const sortSequence = [];

                for (const element of [theadElem, tbodyElem])
                    tableElem.appendChild(element);

                function printDataRows(nestedArray) {
                    tbodyElem.textContent = '';
                    for (const rows of nestedArray) {
                        const trElem = document.createElement('tr');
                        for (const items of rows)
                            trElem.appendChild(initializeHTML('td', {textContent: items}))
                        tbodyElem.appendChild(trElem);
                    }
                }

                const headertr = document.createElement('tr');
                for (const header of tablerows.shift())
                    headertr.appendChild(initializeHTML('th', {textContent: header}));
                theadElem.appendChild(headertr);

                printDataRows(tablerows);

                if (sort) {
                    //three way sort
                    //multi sort
                    alert('Check console.');
                    const samplerow = tablerows[0];
                    for (const [index, headerCell] of Object.entries(headertr.children)) {
                        headerCell.dataset.index = index;
                        const item = samplerow[index];
                        console.log(item, typeof item)

                        //change to generalized
                        switch (typeof item) {
                            case 'string':
                                headerCell.addEventListener('click', function() {
                                    const index = this.dataset.index;
                                    printDataRows(tablerows.sort((a, b) => Compare.string(a[index], b[index])));
                                });
                                break;
                            case 'number':
                                headerCell.addEventListener('click', function() {
                                    const index = this.dataset.index;
                                    printDataRows(tablerows.sort((a, b) => Compare.number(b[index], a[index])));
                                });
                                break;
                            default:
                                console.log(item, typeof item, 'Defaulted')
                                break;
                        }
                        /* if (index == 0) {
                            headerCell.addEventListener('click', function() {
                                const index = this.dataset.index;
                                printDataRows(tablerows.sort((a, b) => Compare.string(a[index], b[index])));
                            })
                        } else {
                            headerCell.addEventListener('click', function() {
                                const index = this.dataset.index;
                                printDataRows(tablerows.sort((a, b) => Compare.number(b[index], a[index])));
                            })
                        } */
                    }
                }

                if (filter) {
                    //unfilter
                    //multifilter
                    for (const [index, headerCell] of Object.entries(headertr.children)) {
                        headerCell.dataset.index = index;
                        headerCell.addEventListener('click', function() {
                            const index = this.dataset.index;
                            printDataRows(tablerows.filter(x => x[index]));
                        });
                    }
                }

                //freeze first column
                //freeze top row

                grouperElem.style.borderStyle = 'inset';
                grouperElem.style.overflowX = 'auto';
                grouperElem.appendChild(tableElem);
            }
        </script>

        <meta charset='utf-8'>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="/univasset/scripts/externalcss.css">
        
        <!-- Setup theme-color -->

        <!-- start theme color meta headers -->
            <meta name="theme-color" content="#151515">
            <meta name="msapplication-navbutton-color" content="#151515">
            <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <!-- end theme color meta headers -->

        <!-- Setup Google Analytics -->

        <link rel="icon" type="image/png" href="/univasset/images/favicon.png" />

        <title>PNC Units Stats | Random Scraps</title>
    </head>

    <style>
    </style>

    <body>
        <include src="/univasset/scripts/pageheader/header.html">"Unit stat table"</include>

        <div class="container">
            <section id="main_content">
                <div></div>
                <br>
                <p>All units at Lv.70 and 5â˜….</p>
                <p>Data taken from <a href="https://nalu.wiki/neuralcloud/c/dolls">nalu.wiki Neural Cloud</a>.</p>
            </section>
        </div>
    </body>
</html>